<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAGI QA System - Architecture Overview</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6B5B95;
            --primary-dark: #4A3F6B;
            --accent: #4ADE80;
            --danger: #EF4444;
            --warning: #F59E0B;
            --info: #06B6D4;
            --dark: #1a1a2e;
            --darker: #0f0f1a;
            --light: #f8fafc;
            --gray: #64748b;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--light);
            color: #1e293b;
            line-height: 1.6;
            font-size: 11pt;
        }

        .page {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            padding: 20mm;
            min-height: 297mm;
            page-break-after: always;
        }

        .page:last-child {
            page-break-after: avoid;
        }

        /* Cover Page */
        .cover {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            min-height: calc(297mm - 40mm);
        }

        .logo {
            width: 120px;
            height: 120px;
            margin-bottom: 40px;
        }

        .logo svg {
            width: 100%;
            height: 100%;
        }

        .cover h1 {
            font-size: 42pt;
            font-weight: 700;
            color: var(--primary);
            letter-spacing: 8px;
            margin-bottom: 10px;
        }

        .cover .subtitle {
            font-size: 16pt;
            color: var(--gray);
            font-weight: 300;
            letter-spacing: 4px;
            margin-bottom: 60px;
        }

        .cover .doc-title {
            font-size: 24pt;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .cover .doc-subtitle {
            font-size: 14pt;
            color: var(--gray);
            font-weight: 400;
        }

        .cover .meta {
            position: absolute;
            bottom: 40mm;
            text-align: center;
            color: var(--gray);
            font-size: 10pt;
        }

        .cover .meta strong {
            color: var(--dark);
        }

        /* Headers */
        h1 {
            font-size: 22pt;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary);
        }

        h2 {
            font-size: 16pt;
            font-weight: 600;
            color: var(--primary-dark);
            margin-top: 25px;
            margin-bottom: 15px;
        }

        h3 {
            font-size: 13pt;
            font-weight: 600;
            color: var(--dark);
            margin-top: 20px;
            margin-bottom: 10px;
        }

        p {
            margin-bottom: 12px;
            text-align: justify;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 10pt;
        }

        th {
            background: var(--primary);
            color: white;
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 9pt;
            letter-spacing: 0.5px;
        }

        td {
            padding: 10px 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        tr:nth-child(even) {
            background: #f8fafc;
        }

        /* Code blocks */
        .code-block {
            background: var(--darker);
            color: #e2e8f0;
            padding: 15px 20px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 9pt;
            margin: 15px 0;
            overflow-x: auto;
            line-height: 1.5;
        }

        .code-block .comment {
            color: #64748b;
        }

        .code-block .keyword {
            color: #c084fc;
        }

        .code-block .string {
            color: #4ade80;
        }

        .code-block .number {
            color: #f59e0b;
        }

        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 9pt;
            color: var(--primary-dark);
        }

        /* Diagrams */
        .diagram {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 9pt;
            line-height: 1.4;
            white-space: pre;
            overflow-x: auto;
        }

        /* Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .card h4 {
            font-size: 11pt;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .card p {
            font-size: 10pt;
            color: var(--gray);
            margin: 0;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card .number {
            font-size: 28pt;
            font-weight: 700;
            display: block;
        }

        .stat-card .label {
            font-size: 9pt;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
        }

        /* Flow arrows */
        .flow-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .flow-box {
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 10pt;
            text-align: center;
            min-width: 120px;
        }

        .flow-arrow {
            color: var(--primary);
            font-size: 20pt;
            font-weight: bold;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 8pt;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-success { background: #dcfce7; color: #166534; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-info { background: #cffafe; color: #155e75; }
        .badge-primary { background: #ede9fe; color: #5b21b6; }

        /* Lists */
        ul, ol {
            margin: 10px 0 15px 25px;
        }

        li {
            margin-bottom: 6px;
        }

        /* Highlight box */
        .highlight {
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
            border-left: 4px solid var(--primary);
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
            margin: 20px 0;
        }

        .highlight h4 {
            color: var(--primary-dark);
            font-weight: 600;
            margin-bottom: 8px;
        }

        /* TOC */
        .toc {
            background: #f8fafc;
            padding: 25px 30px;
            border-radius: 10px;
            margin: 30px 0;
        }

        .toc h2 {
            margin-top: 0;
            margin-bottom: 20px;
        }

        .toc ol {
            margin: 0;
            padding-left: 20px;
        }

        .toc li {
            padding: 8px 0;
            border-bottom: 1px dashed #e2e8f0;
        }

        .toc li:last-child {
            border-bottom: none;
        }

        .toc a {
            color: var(--dark);
            text-decoration: none;
        }

        .toc .page-num {
            float: right;
            color: var(--gray);
        }

        /* Print styles */
        @media print {
            body {
                background: white;
            }

            .page {
                margin: 0;
                padding: 15mm;
                box-shadow: none;
            }

            .no-print {
                display: none;
            }
        }

        /* Feature grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .feature {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18pt;
            flex-shrink: 0;
        }

        .feature-content h4 {
            font-size: 11pt;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 4px;
        }

        .feature-content p {
            font-size: 9pt;
            color: var(--gray);
            margin: 0;
        }
    </style>
</head>
<body>

<!-- COVER PAGE -->
<div class="page">
    <div class="cover">
        <div class="logo">
            <svg viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" fill="none" stroke="#6B5B95" stroke-width="3"/>
                <path d="M50 10 L50 90 M30 30 Q50 50 30 70 M70 30 Q50 50 70 70"
                      fill="none" stroke="#4ADE80" stroke-width="4" stroke-linecap="round"/>
                <circle cx="50" cy="50" r="6" fill="#4ADE80"/>
                <circle cx="50" cy="50" r="35" fill="none" stroke="#6B5B95" stroke-width="1.5" opacity="0.5"/>
            </svg>
        </div>
        <h1>NERV</h1>
        <div class="subtitle">MAGI QA SYSTEM</div>

        <div class="doc-title">Architecture Overview</div>
        <div class="doc-subtitle">Technical Documentation & System Flow</div>

        <div class="meta">
            <p><strong>Version:</strong> 1.0</p>
            <p><strong>Date:</strong> December 2024</p>
            <p><strong>Classification:</strong> Internal Use Only</p>
        </div>
    </div>
</div>

<!-- TABLE OF CONTENTS -->
<div class="page">
    <h1>Table of Contents</h1>

    <div class="toc">
        <ol>
            <li><a href="#overview">Executive Summary <span class="page-num">3</span></a></li>
            <li><a href="#tech">Technology Stack <span class="page-num">4</span></a></li>
            <li><a href="#architecture">System Architecture <span class="page-num">5</span></a></li>
            <li><a href="#data">Data Model <span class="page-num">6</span></a></li>
            <li><a href="#auth">Authentication & Authorization <span class="page-num">7</span></a></li>
            <li><a href="#flow">Application Flow <span class="page-num">8</span></a></li>
            <li><a href="#realtime">Real-Time Features <span class="page-num">9</span></a></li>
            <li><a href="#api">API Integration <span class="page-num">10</span></a></li>
            <li><a href="#features">Key Features <span class="page-num">11</span></a></li>
            <li><a href="#security">Security <span class="page-num">12</span></a></li>
        </ol>
    </div>

    <div class="highlight">
        <h4>About This Document</h4>
        <p>This document provides a comprehensive technical overview of the MAGI QA System, a test management platform built for modern software development teams. It covers the complete architecture, data flow, and integration capabilities.</p>
    </div>
</div>

<!-- EXECUTIVE SUMMARY -->
<div class="page" id="overview">
    <h1>1. Executive Summary</h1>

    <p><strong>MAGI QA</strong> is a comprehensive test management platform designed to streamline the software testing lifecycle. Built with modern web technologies, it provides teams with powerful tools to organize, execute, and track test cases across multiple projects.</p>

    <h2>Key Metrics</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <span class="number">3</span>
            <span class="label">User Roles</span>
        </div>
        <div class="stat-card">
            <span class="number">15+</span>
            <span class="label">API Endpoints</span>
        </div>
        <div class="stat-card">
            <span class="number">Real-Time</span>
            <span class="label">Updates</span>
        </div>
        <div class="stat-card">
            <span class="number">100%</span>
            <span class="label">Cloud Ready</span>
        </div>
    </div>

    <h2>Core Capabilities</h2>
    <div class="feature-grid">
        <div class="feature">
            <div class="feature-icon">&#128203;</div>
            <div class="feature-content">
                <h4>Test Case Management</h4>
                <p>Organize test cases in hierarchical folders with full CRUD operations</p>
            </div>
        </div>
        <div class="feature">
            <div class="feature-icon">&#9889;</div>
            <div class="feature-content">
                <h4>Real-Time Execution</h4>
                <p>Live status updates via WebSocket with instant team visibility</p>
            </div>
        </div>
        <div class="feature">
            <div class="feature-icon">&#128640;</div>
            <div class="feature-content">
                <h4>Cypress Integration</h4>
                <p>Native API for automated test result ingestion from CI/CD</p>
            </div>
        </div>
        <div class="feature">
            <div class="feature-icon">&#128202;</div>
            <div class="feature-content">
                <h4>Analytics Dashboard</h4>
                <p>Comprehensive metrics, charts, and team activity tracking</p>
            </div>
        </div>
    </div>

    <h2>Business Value</h2>
    <ul>
        <li><strong>Increased Visibility:</strong> Real-time dashboards provide instant insight into testing progress</li>
        <li><strong>Improved Collaboration:</strong> Team members see updates instantly without page refreshes</li>
        <li><strong>Automation Ready:</strong> Seamless integration with Cypress and other automation tools</li>
        <li><strong>Flexible Organization:</strong> Hierarchical folder structure adapts to any testing methodology</li>
        <li><strong>Audit Trail:</strong> Complete history of test executions with user attribution</li>
    </ul>
</div>

<!-- TECHNOLOGY STACK -->
<div class="page" id="tech">
    <h1>2. Technology Stack</h1>

    <h2>Backend</h2>
    <table>
        <tr>
            <th>Technology</th>
            <th>Version</th>
            <th>Purpose</th>
        </tr>
        <tr>
            <td><strong>Ruby on Rails</strong></td>
            <td>7.1</td>
            <td>Web application framework</td>
        </tr>
        <tr>
            <td><strong>Ruby</strong></td>
            <td>3.2.2</td>
            <td>Programming language</td>
        </tr>
        <tr>
            <td><strong>PostgreSQL</strong></td>
            <td>14+</td>
            <td>Primary database</td>
        </tr>
        <tr>
            <td><strong>Devise</strong></td>
            <td>4.9</td>
            <td>Authentication</td>
        </tr>
        <tr>
            <td><strong>Pundit</strong></td>
            <td>2.3</td>
            <td>Authorization policies</td>
        </tr>
        <tr>
            <td><strong>Action Cable</strong></td>
            <td>7.1</td>
            <td>WebSocket real-time communication</td>
        </tr>
        <tr>
            <td><strong>Active Storage</strong></td>
            <td>7.1</td>
            <td>File attachments</td>
        </tr>
    </table>

    <h2>Frontend</h2>
    <table>
        <tr>
            <th>Technology</th>
            <th>Version</th>
            <th>Purpose</th>
        </tr>
        <tr>
            <td><strong>Hotwire (Turbo)</strong></td>
            <td>7.3</td>
            <td>SPA-like navigation without JavaScript</td>
        </tr>
        <tr>
            <td><strong>Stimulus</strong></td>
            <td>3.2</td>
            <td>JavaScript controllers</td>
        </tr>
        <tr>
            <td><strong>Tailwind CSS</strong></td>
            <td>3.4</td>
            <td>Utility-first CSS framework</td>
        </tr>
        <tr>
            <td><strong>Chart.js</strong></td>
            <td>4.0</td>
            <td>Data visualization</td>
        </tr>
    </table>

    <h2>Infrastructure & DevOps</h2>
    <table>
        <tr>
            <th>Component</th>
            <th>Technology</th>
        </tr>
        <tr>
            <td>Testing Framework</td>
            <td>RSpec, Factory Bot, Faker</td>
        </tr>
        <tr>
            <td>E2E Testing</td>
            <td>Cypress</td>
        </tr>
        <tr>
            <td>PDF Generation</td>
            <td>Prawn</td>
        </tr>
        <tr>
            <td>Excel Export</td>
            <td>Caxlsx</td>
        </tr>
    </table>

    <div class="highlight">
        <h4>Why This Stack?</h4>
        <p>Ruby on Rails provides rapid development with convention over configuration. Hotwire enables real-time updates without complex JavaScript frameworks. PostgreSQL offers robust data integrity for critical test data.</p>
    </div>
</div>

<!-- SYSTEM ARCHITECTURE -->
<div class="page" id="architecture">
    <h1>3. System Architecture</h1>

    <h2>High-Level Architecture</h2>

    <div class="diagram">
┌─────────────────────────────────────────────────────────────────────┐
│                           CLIENTS                                    │
├─────────────────┬─────────────────┬─────────────────────────────────┤
│   Web Browser   │   Cypress CI    │      External Systems           │
│   (Hotwire)     │   (API Client)  │      (REST API)                 │
└────────┬────────┴────────┬────────┴─────────────┬───────────────────┘
         │                 │                      │
         │    HTTPS        │    HTTPS/JSON        │    HTTPS/JSON
         ▼                 ▼                      ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      RAILS APPLICATION                               │
├─────────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────────┐  │
│  │   Devise     │  │   Pundit     │  │      Action Cable        │  │
│  │   (Auth)     │  │   (Authz)    │  │      (WebSocket)         │  │
│  └──────────────┘  └──────────────┘  └──────────────────────────┘  │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                     CONTROLLERS                               │   │
│  │  Dashboard │ Projects │ TestSuites │ TestRuns │ API::V1::*   │   │
│  └──────────────────────────────────────────────────────────────┘   │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                       SERVICES                                │   │
│  │  CsvImporter │ CsvExporter │ PdfExporter │ NotificationSvc   │   │
│  └──────────────────────────────────────────────────────────────┘   │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                        MODELS                                 │   │
│  │  User │ Project │ TestSuite │ TestCase │ TestRun │ ApiToken  │   │
│  └──────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────┬───────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         PostgreSQL                                   │
│                   (Primary Data Store)                               │
└─────────────────────────────────────────────────────────────────────┘
    </div>

    <h2>Request Flow</h2>
    <div class="flow-container">
        <div class="flow-box">Browser Request</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Authentication</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Authorization</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Controller</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Response</div>
    </div>
</div>

<!-- DATA MODEL -->
<div class="page" id="data">
    <h1>4. Data Model</h1>

    <h2>Entity Relationship Overview</h2>

    <div class="diagram">
┌──────────────────┐
│       USER       │
│──────────────────│
│ id               │
│ email            │
│ role (enum)      │──────────────────────────────────────────┐
│ theme            │                                          │
└────────┬─────────┘                                          │
         │ owns                                               │
         ▼                                                    │
┌──────────────────┐                                          │
│     PROJECT      │                                          │
│──────────────────│                                          │
│ id               │                                          │
│ name             │◄─────────────────────────────────────────┤
│ description      │                                          │
│ user_id (owner)  │                                          │
└────────┬─────────┘                                          │
         │ has many                                           │
    ┌────┴────┬──────────────────┐                           │
    ▼         ▼                  ▼                           │
┌────────┐ ┌────────────┐ ┌─────────────┐                    │
│MILESTONE│ │ TEST_SUITE │ │  TEST_RUN   │                    │
│────────│ │────────────│ │─────────────│                    │
│ name   │ │ name       │ │ name        │                    │
│ due_date│ │ description│ │ user_id     │────────────────────┘
└────────┘ └─────┬──────┘ └──────┬──────┘         (creator)
                 │               │
                 ▼               │
          ┌────────────┐         │
          │ TEST_SCOPE │         │
          │────────────│         │
          │ name       │         │
          │ parent_id  │◄───┐    │
          └─────┬──────┘    │    │
                │           │    │
                │ self-ref  │    │
                └───────────┘    │
                │                │
                ▼                ▼
          ┌────────────┐  ┌───────────────┐
          │ TEST_CASE  │  │ TEST_RUN_CASE │
          │────────────│  │───────────────│
          │ title      │◄─│ test_case_id  │
          │ steps      │  │ test_run_id   │
          │ cypress_id │  │ status (enum) │
          └────────────┘  │ comments      │
                          │ user_id       │───► executor
                          │ attachments   │
                          └───────────────┘
    </div>

    <h2>Key Relationships</h2>
    <table>
        <tr>
            <th>Relationship</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>User → Projects</td>
            <td>One-to-Many</td>
            <td>User owns multiple projects</td>
        </tr>
        <tr>
            <td>Project → TestSuites</td>
            <td>One-to-Many</td>
            <td>Project contains test suite collections</td>
        </tr>
        <tr>
            <td>TestSuite → TestScopes</td>
            <td>One-to-Many</td>
            <td>Hierarchical folder organization</td>
        </tr>
        <tr>
            <td>TestScope → TestScope</td>
            <td>Self-Referential</td>
            <td>Unlimited nesting via parent_id</td>
        </tr>
        <tr>
            <td>TestRun ↔ TestCase</td>
            <td>Many-to-Many</td>
            <td>Via TestRunCase junction table</td>
        </tr>
    </table>
</div>

<!-- AUTHENTICATION & AUTHORIZATION -->
<div class="page" id="auth">
    <h1>5. Authentication & Authorization</h1>

    <h2>Authentication Flow (Devise)</h2>
    <div class="flow-container">
        <div class="flow-box">Login Form</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Devise Validate</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Create Session</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Redirect Dashboard</div>
    </div>

    <h2>User Roles</h2>
    <table>
        <tr>
            <th>Role</th>
            <th>Level</th>
            <th>Description</th>
        </tr>
        <tr>
            <td><span class="badge badge-info">Tester</span></td>
            <td>0</td>
            <td>Execute tests, view results, create test runs</td>
        </tr>
        <tr>
            <td><span class="badge badge-warning">Manager</span></td>
            <td>1</td>
            <td>Full test management, create projects and suites</td>
        </tr>
        <tr>
            <td><span class="badge badge-danger">Admin</span></td>
            <td>2</td>
            <td>Complete system access, user management</td>
        </tr>
    </table>

    <h2>Permission Matrix</h2>
    <table>
        <tr>
            <th>Action</th>
            <th>Tester</th>
            <th>Manager</th>
            <th>Admin</th>
        </tr>
        <tr>
            <td>View Projects</td>
            <td><span class="badge badge-success">Yes</span></td>
            <td><span class="badge badge-success">Yes</span></td>
            <td><span class="badge badge-success">Yes</span></td>
        </tr>
        <tr>
            <td>Create Projects</td>
            <td><span class="badge badge-danger">No</span></td>
            <td><span class="badge badge-success">Yes</span></td>
            <td><span class="badge badge-success">Yes</span></td>
        </tr>
        <tr>
            <td>Delete Projects</td>
            <td><span class="badge badge-danger">No</span></td>
            <td><span class="badge badge-danger">No</span></td>
            <td><span class="badge badge-success">Yes</span></td>
        </tr>
        <tr>
            <td>Create Test Runs</td>
            <td><span class="badge badge-success">Yes</span></td>
            <td><span class="badge badge-success">Yes</span></td>
            <td><span class="badge badge-success">Yes</span></td>
        </tr>
        <tr>
            <td>Execute Tests</td>
            <td><span class="badge badge-success">Yes</span></td>
            <td><span class="badge badge-success">Yes</span></td>
            <td><span class="badge badge-success">Yes</span></td>
        </tr>
        <tr>
            <td>Manage Users</td>
            <td><span class="badge badge-danger">No</span></td>
            <td><span class="badge badge-danger">No</span></td>
            <td><span class="badge badge-success">Yes</span></td>
        </tr>
        <tr>
            <td>API Tokens</td>
            <td><span class="badge badge-success">Own</span></td>
            <td><span class="badge badge-success">Own</span></td>
            <td><span class="badge badge-success">All</span></td>
        </tr>
    </table>

    <h2>API Authentication</h2>
    <div class="code-block">
<span class="comment"># HTTP Header</span>
Authorization: Bearer &lt;api_token&gt;

<span class="comment"># Token Validation</span>
<span class="keyword">def</span> authenticate_api_token!
  token = request.headers[<span class="string">'Authorization'</span>]&.split(<span class="string">' '</span>)&.last
  @api_token = ApiToken.active.find_by(token: token)
  render_unauthorized <span class="keyword">unless</span> @api_token
<span class="keyword">end</span>
    </div>
</div>

<!-- APPLICATION FLOW -->
<div class="page" id="flow">
    <h1>6. Application Flow</h1>

    <h2>Complete User Journey</h2>

    <div class="diagram">
                              ┌─────────────────┐
                              │   USER LOGIN    │
                              └────────┬────────┘
                                       │
                                       ▼
                              ┌─────────────────┐
                              │   DASHBOARD     │
                              │ (Command Center)│
                              └────────┬────────┘
                                       │
              ┌────────────────────────┼────────────────────────┐
              ▼                        ▼                        ▼
    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
    │     PROJECTS    │     │    TEST RUNS    │     │  SYSTEM CONFIG  │
    │    (Missions)   │     │   (Operations)  │     │                 │
    └────────┬────────┘     └────────┬────────┘     └─────────────────┘
             │                       │
             ▼                       │
    ┌─────────────────┐              │
    │   TEST SUITES   │              │
    │ (Protocol Banks)│              │
    └────────┬────────┘              │
             │                       │
             ▼                       │
    ┌─────────────────┐              │
    │    TEST CASES   │◄─────────────┤
    │   (Protocols)   │              │
    └────────┬────────┘              │
             │                       │
             └───────────────────────┤
                                     ▼
                           ┌─────────────────┐
                           │  TEST EXECUTION │
                           │                 │
                           │  Pass │ Fail    │
                           │  Block│ Untest  │
                           └────────┬────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    ▼               ▼               ▼
           ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
           │  WebSocket   │ │ Notification │ │   Reports    │
           │   Update     │ │   Broadcast  │ │  CSV / PDF   │
           └──────────────┘ └──────────────┘ └──────────────┘
    </div>

    <h2>Test Execution Flow (Core Feature)</h2>

    <div class="card-grid">
        <div class="card">
            <h4>1. Select Test Run</h4>
            <p>User navigates to active test run from Operations list or Dashboard</p>
        </div>
        <div class="card">
            <h4>2. View Test Cases</h4>
            <p>All test cases display with current status (STANDBY by default)</p>
        </div>
        <div class="card">
            <h4>3. Execute Test</h4>
            <p>User clicks Pass/Fail/Block button, optionally adds comment</p>
        </div>
        <div class="card">
            <h4>4. Real-Time Update</h4>
            <p>Status broadcasts via WebSocket to all connected team members</p>
        </div>
    </div>
</div>

<!-- REAL-TIME FEATURES -->
<div class="page" id="realtime">
    <h1>7. Real-Time Features</h1>

    <h2>WebSocket Architecture</h2>
    <p>MAGI uses Action Cable (Rails WebSocket implementation) for real-time communication. This enables instant updates without page refreshes.</p>

    <div class="diagram">
┌──────────────────────────────────────────────────────────────────┐
│                         SERVER SIDE                               │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│   TestRunCasesController                                         │
│         │                                                        │
│         │ update status                                          │
│         ▼                                                        │
│   ┌─────────────────────┐                                        │
│   │  TestRunChannel     │                                        │
│   │  .broadcast_to()    │                                        │
│   └──────────┬──────────┘                                        │
│              │                                                   │
└──────────────┼───────────────────────────────────────────────────┘
               │ WebSocket
               ▼
┌──────────────────────────────────────────────────────────────────┐
│                         CLIENT SIDE                               │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│   ┌─────────────────────────────────────────────────────────┐    │
│   │  test_run_updates_controller.js (Stimulus)              │    │
│   │                                                          │    │
│   │  • Update passed/failed/blocked counts                   │    │
│   │  • Update progress bar                                   │    │
│   │  • Animate status change on row                         │    │
│   │  • Show toast notification                              │    │
│   └─────────────────────────────────────────────────────────┘    │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
    </div>

    <h2>Broadcast Data Structure</h2>
    <div class="code-block">
{
  <span class="string">"type"</span>: <span class="string">"status_update"</span>,
  <span class="string">"test_run_case_id"</span>: <span class="number">123</span>,
  <span class="string">"status"</span>: <span class="string">"passed"</span>,
  <span class="string">"user_name"</span>: <span class="string">"John Doe"</span>,
  <span class="string">"passed_count"</span>: <span class="number">45</span>,
  <span class="string">"failed_count"</span>: <span class="number">3</span>,
  <span class="string">"blocked_count"</span>: <span class="number">1</span>,
  <span class="string">"untested_count"</span>: <span class="number">51</span>,
  <span class="string">"completion_percentage"</span>: <span class="number">49</span>
}
    </div>

    <h2>Notification System</h2>
    <table>
        <tr>
            <th>Event</th>
            <th>Recipients</th>
            <th>Channel</th>
        </tr>
        <tr>
            <td>Test Run Completed</td>
            <td>Creator, Project Owner</td>
            <td>NotificationsChannel</td>
        </tr>
        <tr>
            <td>Test Case Failed</td>
            <td>Test Run Creator</td>
            <td>NotificationsChannel</td>
        </tr>
        <tr>
            <td>Assigned to Test Run</td>
            <td>Assigned User</td>
            <td>NotificationsChannel</td>
        </tr>
        <tr>
            <td>Status Change</td>
            <td>All viewers of Test Run</td>
            <td>TestRunChannel</td>
        </tr>
    </table>
</div>

<!-- API INTEGRATION -->
<div class="page" id="api">
    <h1>8. API Integration</h1>

    <h2>REST API Endpoints</h2>
    <table>
        <tr>
            <th>Method</th>
            <th>Endpoint</th>
            <th>Description</th>
        </tr>
        <tr>
            <td><span class="badge badge-success">GET</span></td>
            <td><code>/api/v1/projects</code></td>
            <td>List all projects</td>
        </tr>
        <tr>
            <td><span class="badge badge-success">GET</span></td>
            <td><code>/api/v1/projects/:id</code></td>
            <td>Project details with suites</td>
        </tr>
        <tr>
            <td><span class="badge badge-success">GET</span></td>
            <td><code>/api/v1/test_runs</code></td>
            <td>List test runs</td>
        </tr>
        <tr>
            <td><span class="badge badge-primary">POST</span></td>
            <td><code>/api/v1/projects/:id/test_runs</code></td>
            <td>Create test run</td>
        </tr>
        <tr>
            <td><span class="badge badge-warning">PATCH</span></td>
            <td><code>/api/v1/test_run_cases/:id</code></td>
            <td>Update test result</td>
        </tr>
        <tr>
            <td><span class="badge badge-success">GET</span></td>
            <td><code>/api/v1/test_cases/by_cypress_id/:id</code></td>
            <td>Lookup by Cypress ID</td>
        </tr>
        <tr>
            <td><span class="badge badge-primary">POST</span></td>
            <td><code>/api/v1/test_runs/:id/cypress_results</code></td>
            <td>Bulk import Cypress results</td>
        </tr>
    </table>

    <h2>Cypress Integration Flow</h2>
    <div class="flow-container">
        <div class="flow-box">Cypress Test Run</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Collect Results</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">POST to API</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Match by ID</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Update Status</div>
    </div>

    <h2>Cypress Results Payload</h2>
    <div class="code-block">
<span class="keyword">POST</span> /api/v1/test_runs/<span class="number">123</span>/cypress_results
Authorization: Bearer &lt;token&gt;
Content-Type: application/json

{
  <span class="string">"results"</span>: [
    {
      <span class="string">"cypress_id"</span>: <span class="string">"TC-AUTH-001"</span>,
      <span class="string">"status"</span>: <span class="string">"passed"</span>,
      <span class="string">"duration"</span>: <span class="number">1234</span>
    },
    {
      <span class="string">"cypress_id"</span>: <span class="string">"TC-AUTH-002"</span>,
      <span class="string">"status"</span>: <span class="string">"failed"</span>,
      <span class="string">"duration"</span>: <span class="number">5678</span>,
      <span class="string">"error_message"</span>: <span class="string">"Expected 200 got 401"</span>
    }
  ]
}
    </div>

    <h2>Status Mapping</h2>
    <table>
        <tr>
            <th>Cypress Status</th>
            <th>MAGI Status</th>
            <th>Display</th>
        </tr>
        <tr>
            <td>passed</td>
            <td>passed</td>
            <td><span class="badge badge-success">NOMINAL</span></td>
        </tr>
        <tr>
            <td>failed</td>
            <td>failed</td>
            <td><span class="badge badge-danger">BREACH</span></td>
        </tr>
        <tr>
            <td>skipped / pending</td>
            <td>blocked</td>
            <td><span class="badge badge-warning">PATTERN BLUE</span></td>
        </tr>
    </table>
</div>

<!-- KEY FEATURES -->
<div class="page" id="features">
    <h1>9. Key Features</h1>

    <h2>Feature Overview</h2>

    <div class="feature-grid">
        <div class="feature">
            <div class="feature-icon">&#128193;</div>
            <div class="feature-content">
                <h4>Hierarchical Organization</h4>
                <p>Unlimited folder nesting for test case organization with TestScopes</p>
            </div>
        </div>
        <div class="feature">
            <div class="feature-icon">&#128259;</div>
            <div class="feature-content">
                <h4>CSV Import/Export</h4>
                <p>Bulk operations with auto-detection of multiple CSV formats</p>
            </div>
        </div>
        <div class="feature">
            <div class="feature-icon">&#128200;</div>
            <div class="feature-content">
                <h4>Analytics Dashboard</h4>
                <p>Charts, heatmaps, trends, and team activity tracking</p>
            </div>
        </div>
        <div class="feature">
            <div class="feature-icon">&#128274;</div>
            <div class="feature-content">
                <h4>Role-Based Access</h4>
                <p>Three-tier permission system (Tester, Manager, Admin)</p>
            </div>
        </div>
        <div class="feature">
            <div class="feature-icon">&#128279;</div>
            <div class="feature-content">
                <h4>Attachments</h4>
                <p>Upload screenshots and files as test evidence</p>
            </div>
        </div>
        <div class="feature">
            <div class="feature-icon">&#128276;</div>
            <div class="feature-content">
                <h4>Real-Time Notifications</h4>
                <p>Instant alerts for test events via WebSocket</p>
            </div>
        </div>
        <div class="feature">
            <div class="feature-icon">&#128196;</div>
            <div class="feature-content">
                <h4>PDF/Excel Reports</h4>
                <p>Export test runs and cases to PDF or Excel</p>
            </div>
        </div>
        <div class="feature">
            <div class="feature-icon">&#127912;</div>
            <div class="feature-content">
                <h4>Theme Support</h4>
                <p>NERV dark theme and Light theme options</p>
            </div>
        </div>
    </div>

    <h2>Dashboard Metrics</h2>
    <table>
        <tr>
            <th>Metric</th>
            <th>Description</th>
            <th>Timeframe</th>
        </tr>
        <tr>
            <td>Active Operations</td>
            <td>Test runs in progress</td>
            <td>Last 30 days</td>
        </tr>
        <tr>
            <td>Telemetry Chart</td>
            <td>Pass/Fail/Block daily counts</td>
            <td>Last 14 days</td>
        </tr>
        <tr>
            <td>Pass Rate Trend</td>
            <td>Historical pass rate percentage</td>
            <td>Last 30 days</td>
        </tr>
        <tr>
            <td>Activity Heatmap</td>
            <td>Team contribution calendar</td>
            <td>Last 365 days</td>
        </tr>
        <tr>
            <td>Top Failed Tests</td>
            <td>Most frequently failing test cases</td>
            <td>All time</td>
        </tr>
    </table>
</div>

<!-- SECURITY -->
<div class="page" id="security">
    <h1>10. Security</h1>

    <h2>Security Measures</h2>

    <table>
        <tr>
            <th>Layer</th>
            <th>Protection</th>
            <th>Implementation</th>
        </tr>
        <tr>
            <td>Authentication</td>
            <td>Session-based with encrypted cookies</td>
            <td>Devise gem with bcrypt password hashing</td>
        </tr>
        <tr>
            <td>Authorization</td>
            <td>Policy-based access control</td>
            <td>Pundit gem with per-resource policies</td>
        </tr>
        <tr>
            <td>CSRF Protection</td>
            <td>Token verification on forms</td>
            <td>Rails authenticity_token</td>
        </tr>
        <tr>
            <td>API Security</td>
            <td>Bearer token authentication</td>
            <td>ApiToken model with expiration</td>
        </tr>
        <tr>
            <td>Input Validation</td>
            <td>Strong parameters whitelist</td>
            <td>Rails permit/require</td>
        </tr>
        <tr>
            <td>SQL Injection</td>
            <td>Parameterized queries</td>
            <td>ActiveRecord ORM</td>
        </tr>
        <tr>
            <td>XSS Prevention</td>
            <td>Output escaping</td>
            <td>Rails ERB auto-escaping</td>
        </tr>
        <tr>
            <td>Data Integrity</td>
            <td>Foreign key constraints</td>
            <td>PostgreSQL constraints</td>
        </tr>
    </table>

    <h2>API Token Lifecycle</h2>
    <div class="flow-container">
        <div class="flow-box">Generate Token</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Set Expiration</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Use in Requests</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Track Usage</div>
        <span class="flow-arrow">→</span>
        <div class="flow-box">Revoke/Expire</div>
    </div>

    <div class="highlight">
        <h4>Security Best Practices Implemented</h4>
        <ul>
            <li>All passwords hashed with bcrypt (cost factor 12)</li>
            <li>API tokens are one-way hashed in database</li>
            <li>Session cookies are HTTP-only and secure</li>
            <li>All database queries use parameterized statements</li>
            <li>User input is validated and sanitized</li>
            <li>HTTPS enforced in production</li>
        </ul>
    </div>

    <br><br>

    <div style="text-align: center; padding: 40px; background: linear-gradient(135deg, #6B5B95 0%, #4A3F6B 100%); border-radius: 10px; color: white;">
        <h2 style="color: white; border: none; margin: 0 0 10px 0;">MAGI QA System</h2>
        <p style="margin: 0; opacity: 0.9;">"God's in His Heaven. All's Right with the World."</p>
    </div>
</div>

</body>
</html>
