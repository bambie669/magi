<% content_for :page_title, "Notifications" %>

<div class="panel">
  <div class="panel-header flex items-center justify-between">
    <div class="flex items-center space-x-4">
      <span>Notifications</span>
      <% if @unread_count > 0 %>
        <span class="px-2 py-0.5 bg-status-error/20 border border-status-error/50 text-status-error text-[10px] font-mono uppercase">
          <%= @unread_count %> Unread
        </span>
      <% end %>
    </div>
    <% if @unread_count > 0 %>
      <%= button_to mark_all_as_read_notifications_path, method: :post, class: "text-[10px] font-mono text-primary uppercase tracking-wider hover:text-primary/80 transition-colors" do %>
        Mark All as Read
      <% end %>
    <% end %>
  </div>

  <% if @notifications.any? %>
    <div class="divide-y divide-dark-border">
      <% @notifications.each do |notification| %>
        <div class="p-4 hover:bg-dark-hover transition-colors <%= notification.read? ? 'opacity-60' : '' %>"
             id="notification_<%= notification.id %>">
          <div class="flex items-start space-x-4">
            <!-- Status Indicator -->
            <div class="flex-shrink-0 mt-1">
              <span class="block w-2 h-2 rounded-full <%= notification.read? ? 'bg-text-muted' : 'bg-primary animate-pulse' %>"></span>
            </div>

            <!-- Content -->
            <div class="flex-1 min-w-0">
              <div class="flex items-center space-x-2 mb-1">
                <span class="text-[10px] font-mono uppercase tracking-wider <%= notification.type_class %>">
                  <%= notification.type_label %>
                </span>
                <span class="text-[10px] font-mono text-text-muted">
                  <%= time_ago_in_words(notification.created_at) %> ago
                </span>
              </div>
              <p class="text-sm font-mono text-text-primary/90 mb-2">
                <%= notification.message %>
              </p>

              <!-- Action Buttons -->
              <div class="flex items-center space-x-3">
                <% if notification.notifiable.present? %>
                  <% case notification.notifiable_type %>
                  <% when 'TestRun' %>
                    <%= link_to test_run_path(notification.notifiable), class: "text-[10px] font-mono text-primary uppercase tracking-wider hover:text-primary/80" do %>
                      View Test Run
                    <% end %>
                  <% when 'TestCase' %>
                    <%= link_to test_case_path(notification.notifiable), class: "text-[10px] font-mono text-primary uppercase tracking-wider hover:text-primary/80" do %>
                      View Test Case
                    <% end %>
                  <% when 'Project' %>
                    <%= link_to project_path(notification.notifiable), class: "text-[10px] font-mono text-primary uppercase tracking-wider hover:text-primary/80" do %>
                      View Project
                    <% end %>
                  <% end %>
                <% end %>

                <% unless notification.read? %>
                  <%= button_to mark_as_read_notification_path(notification), method: :post, class: "text-[10px] font-mono text-text-muted uppercase tracking-wider hover:text-text-primary transition-colors" do %>
                    Mark Read
                  <% end %>
                <% end %>
              </div>
            </div>

            <!-- Timestamp -->
            <div class="flex-shrink-0 text-right">
              <p class="text-[10px] font-mono text-text-muted">
                <%= notification.created_at.strftime('%Y.%m.%d') %>
              </p>
              <p class="text-[10px] font-mono text-text-muted">
                <%= notification.created_at.strftime('%H:%M:%S') %>
              </p>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <%= render 'shared/pagination', pagy: @pagy %>
  <% else %>
    <div class="p-8 text-center">
      <svg class="w-12 h-12 mx-auto text-text-muted/50 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
      </svg>
      <p class="text-text-muted font-mono text-sm uppercase tracking-wider">No notifications</p>
      <p class="text-text-muted/60 font-mono text-xs mt-1">You're all caught up</p>
    </div>
  <% end %>
</div>
