<%# locals: (test_suite:, project: nil) %>
<% url = test_suite.persisted? ? test_suite_path(test_suite) : project_test_suites_path(project) %>
<% the_project = test_suite.persisted? ? test_suite.project : project %>

<div class="nerv-panel">
  <div class="nerv-panel-header flex items-center justify-between">
    <span><%= test_suite.persisted? ? 'MODIFY PROTOCOL BANK' : 'INITIALIZE PROTOCOL BANK' %></span>
    <span class="text-[10px] font-mono text-terminal-cyan">Mission: <%= the_project.name %></span>
  </div>

  <div class="p-6">
    <%= form_with(model: test_suite, url: url, class: "space-y-6") do |form| %>
      <% if test_suite.errors.any? %>
        <div class="p-4 bg-terminal-red/10 border border-terminal-red/50 text-terminal-red font-mono text-sm animate-pulse" role="alert">
          <div class="flex items-center space-x-2 mb-2">
            <span class="w-2 h-2 bg-terminal-red rounded-full"></span>
            <span class="uppercase tracking-wider text-xs">System Error:</span>
          </div>
          <strong class="font-bold"><%= pluralize(test_suite.errors.count, "error") %> prohibited this protocol bank from being saved:</strong>
          <ul class="mt-2 list-disc list-inside text-sm">
            <% test_suite.errors.each do |error| %>
              <li><%= error.full_message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div>
        <%= form.label :name, "Bank Designation", class: "block text-[10px] font-mono text-terminal-amber uppercase tracking-wider mb-2" %>
        <%= form.text_field :name, class: "input-nerv w-full px-4 py-3 text-sm", placeholder: "Enter protocol bank designation..." %>
      </div>

      <div>
        <%= form.label :description, "Bank Description", class: "block text-[10px] font-mono text-terminal-amber uppercase tracking-wider mb-2" %>
        <%= form.text_area :description, rows: 4, class: "input-nerv w-full px-4 py-3 text-sm resize-none", placeholder: "Describe protocol bank purpose..." %>
        <p class="mt-1 text-[10px] font-mono text-terminal-gray">Overview of protocols contained in this bank</p>
      </div>

      <div class="flex justify-end space-x-3 pt-6 border-t border-terminal-red/20">
        <%= link_to 'Abort', project_path(the_project), class: "px-4 py-2 bg-nerv-purple-mid border border-terminal-gray-dark text-terminal-gray text-xs font-mono uppercase tracking-wider hover:text-terminal-white transition-colors" %>
        <%= form.submit test_suite.persisted? ? 'Update Bank' : 'Initialize Bank', class: "btn-nerv-primary cursor-pointer" %>
      </div>
    <% end %>
  </div>
</div>
